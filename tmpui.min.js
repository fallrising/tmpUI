class tmpUI{status={};config={};version=0;index="/";debug=!0;reloadTable={};resPath="";googleAnalytics=!1;googleAnalyticsQueue=[];dynamicRouter=null;languageConfig=!1;languageData=!1;languageSetting="en";loadDelay=500;loadCallback=[];readyFunction=[];loadingPageInit=!1;loadingPage=!1;loadingIcon=!1;loadingText="Loading...";readyCallback=null;progressEnable=!0;progressStatus=!1;currentRoute="/";onExitfunction=[];filesCache=[];constructor(t){this.state={displayTrophy:!0},window.tmpuiHelper={loadQueue:0,loadTotal:0,readyQueue:0,readyTotal:0},history.replaceState(this.state,null,""),this.config=this.rebuildConfig(t),this.rebuildRunConfig(t),this.cssInit(),window.onload=()=>{this.route()},window.addEventListener("popstate",(t=>{this.route()}))}cssInit(){this.htmlAppend("head","<style>body::-webkit-scrollbar{width:0!important}#tmpui_loading_bg{position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;z-index:15000}#tmpui_loading_show{color:#000;z-index:15001;width:200px;height:200px;position:absolute;left:0;top:0;right:0;bottom:0;margin:auto;text-align:center}.tmpui_tpl{display:none}.tmpui_progress{width:180px;background:#ddd;margin-right:auto;margin-left:auto}.tmpui_curRate{width:0%;background:#f30}.tmpui_round_conner{height:8px;border-radius:15px}</div>")}onExit(t){this.onExitfunction.push(t)}doExit(){if(0!==this.onExitfunction.length){for(let t in this.onExitfunction)this.onExitfunction[t]();this.onExitfunction=[]}}ready(t){this.readyFunction.push(t)}readyExec(){if(0!==this.readyFunction.length){for(let t in this.readyFunction)this.readyFunction[t]();this.readyFunction=[]}this.log("Send GoogleAnalytics : "+document.title),gtag("event","page_view",{page_title:document.title,page_path:this.currentRoute,send_to:this.googleAnalytics})}readyEvent(){window.tmpuiHelper.readyQueue==window.tmpuiHelper.readyTotal?(this.readyExec(),this.loadpage(!1),this.log("Ready")):setTimeout((()=>{this.readyEvent()}),500)}loadGtag(t){var e=document.createElement("script");e.src="https://www.googletagmanager.com/gtag/js?id="+t,e.type="text/javascript",e.async=!1,document.head.appendChild(e);var i=document.createElement("script");i.innerHTML='window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag(\'js\', new Date());gtag("config", "'+this.googleAnalytics+'");',i.type="text/javascript",i.async=!1,document.head.appendChild(i)}rebuildRunConfig(t){void 0!==this.config.loadingPage&&(this.loadingPage=this.config.loadingPage),void 0!==this.config.loadingText&&(this.loadingText=this.config.loadingText),void 0!==this.config.loadingIcon&&(this.loadingIcon=this.config.loadingIcon),void 0!==this.config.version&&(this.version=this.config.version),void 0!==this.config.language&&(this.languageConfig=this.config.language),void 0!==this.config.loadingProgress&&(this.progressEnable=this.config.loadingProgress),void 0!==this.config.dynamicRouter&&(this.dynamicRouter=this.config.dynamicRouter),void 0!==this.config.resPath&&(this.resPath=this.config.resPath),void 0!==this.config.pageNotFound&&(this.pageNotFound=this.config.pageNotFound),!1!==this.config.googleAnalytics&&(this.loadGtag(this.config.googleAnalytics),this.log("Load GoogleAnalytics : "+this.config.googleAnalytics),this.loadgoogleAnalytics=this.config.googleAnalytics,this.googleAnalytics=this.config.googleAnalytics)}rebuildConfig(t){if(void 0!==t.path)for(let e in t.path){if(t.path[e].res={},void 0!==t.path[e].preload)for(let i in t.path[e].preload){let o=t.path[e].preload[i];for(let i in t.preload[o])t.path[e].res[i]={},t.path[e].res[i]=t.preload[o][i]}if(void 0!==t.path[e].body)for(let i in t.path[e].body)t.path[e].res[i]=t.path[e].body[i];if(void 0!==t.path[e].append)for(let i in t.path[e].append){let o=t.path[e].append[i];for(let i in t.append[o])t.path[e].res[i]={},t.path[e].res[i]=t.append[o][i]}}return t.reloadTable={},t}linkRebind(){let t=document.getElementsByTagName("a");if(t.length>0)for(let e in t)if("object"==typeof t[e]){if("PRE"===t[e].parentNode.nodeName||"CODE"===t[e].parentNode.nodeName)continue;if("true"==t[e].getAttribute("tmpui-app")&&"true"!=t[e].getAttribute("tmpui-app-rebind")){let i="_blank"==t[e].getAttribute("target"),o="",n=t[e].getAttribute("href").split("?");o=1===n.length?this.index+"?tmpui_page="+n[0]:this.index+"?tmpui_page="+n[0]+"&"+n[1],t[e].setAttribute("tmpui-app-rebind","true"),t[e].setAttribute("href",o),i||t[e].addEventListener("click",(t=>{t.preventDefault(),history.pushState({newPage:o},null,o),this.route()}))}}let e=document.getElementsByTagName("code");if(e.length>0)for(let t in e)if("object"==typeof e[t]){if("true"==e[t].getAttribute("tmpui-html-code")){let i=e[t].innerHTML;e[t].innerHTML=i.toString().replace(/[<>&"]/g,(t=>({"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[t]))),e[t].setAttribute("tmpui-html-code","loaded")}}return"ok"}autofix(){if(""!==this.config.siteroot){var t=this.config.siteroot;this.domSelect("[tmpui-root]",(e=>{let i=e.getAttribute("tmpui-root"),o=e.getAttribute("src"),n=e.getAttribute("href");"true"===i&&null!=o&&(e.setAttribute("src",t+o),e.setAttribute("tmpui-root","false")),"true"===i&&null!=n&&(e.setAttribute("href",t+n),e.setAttribute("tmpui-root","false"))}))}}open(t,e){let i=this.index+"?tmpui_page="+t;if(!0===e)return window.open(i),!1;history.pushState({newPage:i},null,i),this.route()}route(){let t="/",e=null,i=!1,o=window.location.href;""!==window.location.hash&&(o=window.location.href.substr(0,window.location.href.indexOf(window.location.hash)),i=window.location.hash);let n=window.location.href.replace(window.location.origin,"");if(this.log("Send googleAnalytics : "+n),this.currentRoute=n,e=this.getUrlVars(o),void 0!==e.tmpui_page&&(t=e.tmpui_page),document.querySelectorAll(".tmpUIRes").forEach((t=>t.parentNode.removeChild(t))),this.loadpage(!0),!1!==i&&!this.loadingPage)return!1;if(void 0===this.config.path[t]){if(null!==this.dynamicRouter){let e=this.resPath+this.dynamicRouter+t+".json",i=new XMLHttpRequest;return i.onloadend=()=>{200==i.status||304==i.status?(this.config.path[t]=JSON.parse(i.responseText),this.rebuildConfig(this.config),this.route200(t)):this.route404(t)},i.open("GET",e+"?v="+this.version,!0),i.send(),!0}this.route404(t)}else this.route200(t)}route200(t){this.loaderStart(t,(()=>{document.title=this.config.path[t].title,this.draw(t),this.autofix(),this.linkRebind()}))}route404(t){return this.log("Page not found : "+t),void 0!==this.pageNotFound?this.route200(this.pageNotFound):this.route200("/"),this.log("Page not found : "+t),!1}draw(t){for(let e in this.config.path[t].res){let i=this.config.path[t].res[e].type,o=this.config.path[t].res[e].reload,n=!1===o?"tmpUIRes_once":"tmpUIRes";if("css"===i){if(!1===o){if(!1!==this.reloadTable[e])continue;this.reloadTable[e]=!0}this.htmlAppend("head",`\x3c!--[${e}]--\x3e`),this.htmlAppend("head",`<link class="${n}" rel="stylesheet" href="${e}?v=${this.config.version}" sync>`)}}for(let e in this.config.path[t].res){let i=this.config.path[t].res[e].type,o=this.config.path[t].res[e].dom,n=this.config.path[t].res[e].reload,a=!1===n?"tmpUIRes_once":"tmpUIRes";if("js"===i){if(!1===n){if(!1!==this.reloadTable[e])continue;this.reloadTable[e]=!0}this.htmlAppend("body",`\x3c!--[${e}]--\x3e`);let t=document.createElement("script");t.type="text/javascript",t.text=`${o}`,t.className=a,document.body.appendChild(t)}if("css"===i){if(!1===n){if(!1!==this.reloadTable[e])continue;this.reloadTable[e]=!0}this.htmlAppend("head",`\x3c!--[${e}]--\x3e`),this.htmlAppend("head",`<link class="${a}" rel="stylesheet" href="${e}?v=${this.config.version}">`)}if("tpl"===i){if(!1===n){if(!1!==this.reloadTable[e])continue;this.reloadTable[e]=!0}this.htmlAppend("body",`\x3c!--[${e}]--\x3e`),this.htmlAppend("body",`<div class="${a}" style="display:none">${o}</div>\n`)}if("file"===i){if(this.filesCache[e]=o,!1!==this.reloadTable[e])continue;this.reloadTable[e]=!0}if("html"===i&&("append"===this.config.path[t].res[e].target.type&&(this.htmlAppend("#tmpui_body",`\x3c!--[${e}]--\x3e`),this.htmlAppend("#tmpui_body",o)),"body"===this.config.path[t].res[e].target.type&&(this.htmlAppend("#tmpui_body",`\x3c!--[${e}]--\x3e`),this.htmlRewrite("#tmpui_body",o)),"id"===this.config.path[t].res[e].target.type)){let i=this.config.path[t].res[e].target.val;this.htmlAppend("#"+i,`\x3c!--[${e}]--\x3e`),this.htmlReplaceWith("#"+i,o)}}!1!==this.languageConfig&&this.languageBuild(),this.readyEvent()}loaderStart(t,e){this.loadCallback=e;for(let e in this.config.path[t].res)window.tmpuiHelper.loadTotal++;for(let e in this.config.path[t].res)this.loaderUnit(t,e)}loaderUnit(t,e){if(void 0===this.config.path[t].res[e].state&&(this.config.path[t].res[e].state=0,this.config.path[t].res[e].dom=0),!1===this.config.path[t].res[e].reload&&void 0===this.reloadTable[e]&&(this.reloadTable[e]=!1),1===this.config.path[t].res[e].state)window.tmpuiHelper.loadQueue++,this.loaderFinish();else{let i=new XMLHttpRequest;i.onloadend=()=>{"200"!=i.status&&"302"!=i.status&&this.logError("can't load [http code "+i.status+"]"+e),window.tmpuiHelper.loadQueue++,this.config.path[t].res[e].state=1,this.config.path[t].res[e].dom=i.responseText,this.loaderFinish()},i.ontimeout=()=>{this.logError("can't load [timeout]"+e)},i.onerror=()=>{this.logError("can't load [error]"+e)},i.onabort=()=>{this.logError("can't load [abort]"+e)},i.open("GET",this.resPath+e+"?v="+this.version,!0),i.send()}}loaderFinish(){this.progressEnable&&!1===this.progressStatus&&(this.progressStatus=!0,this.htmlAppend("#tmpui_loading_show",'<div class="tmpui_progress tmpui_round_conner" id="tmpui_loading_progress"><div class="tmpui_curRate tmpui_round_conner"></div></div>'));let t=Math.ceil(window.tmpuiHelper.loadQueue/window.tmpuiHelper.loadTotal*100);this.domSelect(".tmpui_curRate",(e=>{e.style.width=`${t}%`,100===t&&(document.body.style.overflow="",document.getElementById("tmpui_loading_progress").style.display="none")})),window.tmpuiHelper.loadQueue==window.tmpuiHelper.loadTotal&&(this.log("Loading is complete."),"function"==typeof this.loadCallback&&(this.log("Callback is running."),this.loadCallback()),this.loadCallback=null,this.progressStatus=!0)}title(t){window.title=t}languageSet(t){if(this.log("languageSet : "+t),localStorage.getItem("tmpUI_language")===t)return!1;localStorage.setItem("tmpUI_language",t),this.languageBuild()}languageGet(){return localStorage.getItem("tmpUI_language")}async languageBuild(){var t=localStorage.getItem("tmpUI_language");if(null===t){switch(this.log("language auto detect : "+t),navigator.language){case"zh-CN":this.languageSetting="cn";break;case"zh-TW":this.languageSetting="hk";break;case"zh-SG":this.languageSetting="cn";break;case"zh-HK":this.languageSetting="hk";break;case"ja-JP":this.languageSetting="jp";break;case"ko-KR":this.languageSetting="kr";break;case"ru-MI":this.languageSetting="ru";break;case"ms":this.languageSetting="ms";break;case"de":this.languageSetting="de";break;case"fr":this.languageSetting="fr";break;case"en-US":this.languageSetting="en";break;default:this.languageSetting="en";break}localStorage.setItem("tmpUI_language",this.languageSetting)}else this.languageSetting=t;window.tmpuiHelper.readyTotal++;let e=await fetch(this.languageConfig[this.languageSetting]+"?v="+this.version),i=await e.json();window.tmpuiHelper.readyQueue++,this.languageData=i;let o={};null!=i&&(o=i),this.domSelect("[i18n]",(t=>{let e=t.getAttribute("i18n-only");null!=t.value&&""!=t.value&&(null!=e&&null!=e&&""!=e&&"value"!=e||(t.value=o[t.getAttribute("i18n")])),null!=t.innerHTML&&""!=t.innerHTML&&(null!=e&&null!=e&&""!=e&&"html"!=e||(t.innerHTML=o[t.getAttribute("i18n")])),null!=t.getAttribute("placeholder")&&""!=t.getAttribute("placeholder")&&(null!=e&&null!=e&&""!=e&&"placeholder"!=e||t.setAttribute("placeholder",o[t.getAttribute("i18n")])),null!=t.getAttribute("content")&&""!=t.getAttribute("content")&&(null!=e&&null!=e&&""!=e&&"content"!=e||t.setAttribute("content",o[t.getAttribute("i18n")])),null!=t.getAttribute("title")&&""!=t.getAttribute("title")&&(null!=e&&null!=e&&""!=e&&"title"!=e||t.setAttribute("title",o[t.getAttribute("i18n")]))}))}description(t){$("meta[name=description]").attr("content",t)}loadpage(t){if(!this.loadingPage)return this.log("Loading page exit."),this.ready_exec(),!1;if(this.loadingPageInit||(this.htmlAppend("#tmpui",'<div id="tmpui_loading_bg" style="background-color: rgba(255, 255, 255, 0.8);-webkit-backdrop-filter:saturate(180%) blur(20px);backdrop-filter: saturate(180%) blur(20px);"></div>'),this.htmlAppend("#tmpui_loading_bg",'<div id="tmpui_loading_show"></div>'),this.htmlAppend("#tmpui_loading_show",'<div style="text-align:center;margin-bottom:20px;" id="tmpui_loading_content"></div>'),!1!==this.loadingIcon?this.htmlAppend("#tmpui_loading_content",'<img src="'+this.loadingIcon+'" style="vertical-align: middle;border-style: none;width:129px;height:129px;"/>'):this.htmlAppend("#tmpui_loading_content",'<div style="text-align:center;font-family: fa5-proxima-nova,"Helvetica Neue",Helvetica,Arial,sans-serif;">'+this.loadingText+"</div>"),this.loadingPageInit=!0,this.log("Loading page created.")),t)document.body.style.overflow="hidden",this.domShow("#tmpui"),this.doExit(),this.log("Loading page on");else if(document.body.style.overflow="",this.domHide("#tmpui"),this.log("Loading page off"),this.progressEnable)return!0}getFile(t){return this.filesCache[t]}tpl(t,e){let i=$("#"+t).html();return this.templateEngine(i,e)}templateEngine(t,e){if(""==t||null==t)return"";for(var i,o,n=/<%(.+?)%>/g,a=/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g,l="with(obj) { var r=[];\n",s=0,r=function(t,e){return l+=e?t.match(a)?t+"\n":"r.push("+t+");\n":""!=t?'r.push("'+t.replace(/"/g,'\\"')+'");\n':"",r};o=n.exec(t);)r(t.slice(s,o.index))(o[1],!0),s=o.index+o[0].length;r(t.substr(s,t.length-s)),l=(l+'return r.join(""); }').replace(/[\r\t\n]/g," ");try{i=new Function("obj",l).apply(e,[e])}catch(t){}return i}domSelect(t,e){return document.querySelectorAll(t).forEach(e),this}htmlAppend(t,e){this.domSelect(t,(t=>{t.insertAdjacentHTML("beforeEnd",e)}))}htmlRewrite(t,e){this.domSelect(t,(t=>{t.innerHTML=e}))}htmlReplaceWith(t,e){this.domSelect(t,(t=>{t.outerHTML=e}))}domShow(t){this.domSelect(t,(t=>{t.style.display="block"}))}domHide(t){this.domSelect(t,(t=>{t.style.display="none"}))}getUrlVars(t){var e={};t.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(t,i,o){e[i]=o}));return e}log(t){this.debug}logError(t){}}
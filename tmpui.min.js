/**
 * tmpUI.js
 * version: 6
 * Github : https://github.com/tmplink/tmpUI
 * Date : 2021-1-7
 */
"use strict";function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class tmpUI{constructor(t){_defineProperty(this,"status",{}),_defineProperty(this,"config",{}),_defineProperty(this,"version",0),_defineProperty(this,"index","/"),_defineProperty(this,"debug",!0),_defineProperty(this,"dynamicRouter",null),_defineProperty(this,"language_config",!1),_defineProperty(this,"language_data",!1),_defineProperty(this,"language_setting","en"),_defineProperty(this,"loadDelay",500),_defineProperty(this,"loadCallback",[]),_defineProperty(this,"readyFunction",[]),_defineProperty(this,"loadingPageInit",!1),_defineProperty(this,"loadingPage",!1),_defineProperty(this,"loadingIcon",!1),_defineProperty(this,"loadingText","Loading..."),_defineProperty(this,"readyCallback",null),_defineProperty(this,"progress_enable",!0),_defineProperty(this,"progress_status",!1),_defineProperty(this,"animation_time",500),_defineProperty(this,"animation_stime",0),_defineProperty(this,"onExitfunction",[]),this.state={displayTrophy:!0},window.tmpui_helper={loadQueue:0,loadTotal:0,readyQueue:0,readyTotal:0},this.loadConfig(t,t=>{history.replaceState(this.state,null,""),this.config=this.rebuildConfig(t),this.rebuildRunConfig(),this.route(),window.addEventListener("popstate",t=>{this.route()})})}onExit(t){this.onExitfunction.push(t)}doExit(){if(0!==this.onExitfunction.length){for(let t in this.onExitfunction)this.onExitfunction[t]();this.onExitfunction=[]}}ready(t){this.readyFunction.push(t)}readyExec(){if(0!==this.readyFunction.length){for(let t in this.readyFunction)this.readyFunction[t]();this.readyFunction=[]}}readyEvent(){window.tmpui_helper.readyQueue==window.tmpui_helper.readyTotal?(this.readyExec(),this.log("Ready")):setTimeout(()=>{this.readyEvent()},1e3)}loadConfig(t,e){let i=new XMLHttpRequest,n={},a=t+"?"+Date.parse(new Date);i.onreadystatechange=function(){4==this.readyState&&200==this.status&&(n=JSON.parse(this.responseText),e(n))},i.open("GET",a,!0),i.send()}rebuildRunConfig(t){void 0!==this.config.loadingPage&&(this.loadingPage=this.config.loadingPage),void 0!==this.config.loadingText&&(this.loadingText=this.config.loadingText),void 0!==this.config.loadingIcon&&(this.loadingIcon=this.config.loadingIcon),void 0!==this.config.version&&(this.version=this.config.version),void 0!==this.config.language&&(this.language_config=this.config.language),void 0!==this.config.loadingProgress&&(this.progress_enable=this.config.loadingProgress),void 0!==this.config.loadingAnimationTime&&(this.animation_time=this.config.loadingAnimationTime),void 0!==this.config.dynamicRouter&&(this.dynamicRouter=this.config.dynamicRouter),void 0!==this.config.pageNotFound&&(this.pageNotFound=this.config.pageNotFound)}rebuildConfig(t){if(void 0!==t.path)for(let e in t.path){if(t.path[e].res={},void 0!==t.path[e].preload)for(let i in t.path[e].preload){let n=t.path[e].preload[i];for(let i in t.preload[n])t.path[e].res[i]={},t.path[e].res[i]=t.preload[n][i]}if(void 0!==t.path[e].body)for(let i in t.path[e].body)t.path[e].res[i]=t.path[e].body[i];if(void 0!==t.path[e].append)for(let i in t.path[e].append){let n=t.path[e].append[i];for(let i in t.append[n])t.path[e].res[i]={},t.path[e].res[i]=t.append[n][i]}}return t.reload_table={},t}linkRebind(){let t=document.getElementsByTagName("a");if(t.length>0)for(let e in t)if("object"==typeof t[e]){if("PRE"===t[e].parentNode.nodeName||"CODE"===t[e].parentNode.nodeName)continue;if("true"==t[e].getAttribute("tmpui-app")&&"true"!=t[e].getAttribute("tmpui-app-rebind")){let i="",n=t[e].getAttribute("href").split("?");i=1===n.length?this.index+"?tmpui_page="+n[0]:this.index+"?tmpui_page="+n[0]+"&"+n[1],t[e].setAttribute("tmpui-app-rebind","true"),t[e].setAttribute("href",i),t[e].addEventListener("click",t=>{t.preventDefault(),history.pushState({newPage:i},null,i),this.route()})}}let e=document.getElementsByTagName("code");if(e.length>0)for(let t in e)if("object"==typeof e[t]){if("true"==e[t].getAttribute("tmpui-html-code")){let i=e[t].innerHTML;e[t].innerHTML=i.toString().replace(/[<>&"]/g,t=>({"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"})[t]),e[t].setAttribute("tmpui-html-code","loaded")}}return"ok"}autofix(){if(""!==this.config.siteroot){var t=this.config.siteroot;$("[tmpui-root]").each(function(){var e=$(this).attr("tmpui-root"),i=$(this).attr("src"),n=$(this).attr("href");"true"===e&&null!=i&&($(this).attr("src",t+i),$(this).attr("tmpui-root","false")),"true"===e&&null!=n&&($(this).attr("href",t+n),$(this).attr("tmpui-root","false"))})}}open(t){let e=this.index+"?tmpui_page="+t;history.pushState({newPage:e},null,e),this.route()}route(){let t="/",e=null;if(void 0!==(e=this.getUrlVars(window.location.href)).tmpui_page&&(t=e.tmpui_page),$(".tmpUIRes").remove(),this.loadpage(!0),void 0===this.config.path[t]){if(null!==this.dynamicRouter){let e=this.config.siteroot+this.dynamicRouter+t+".json",i=new XMLHttpRequest;return i.onreadystatechange=(()=>{4!=i.readyState||200!=i.status&&304!=i.status||(this.config.path[t]=JSON.parse(i.responseText),this.rebuildConfig(this.config),this.route_core(t)),4!=i.readyState||404!=i.status&&403!=i.status||this.route_unfound(t)}),i.open("GET",e+"?v="+this.version,!0),i.send(),!0}return this.route_unfound(t),!1}this.route_core(t)}route_core(t){this.loaderStart(t,()=>{document.title=this.config.path[t].title,this.draw(t),this.autofix(),this.linkRebind(),setTimeout(()=>{this.loadpage(!1)},this.loadDelay)})}route_unfound(t){return null!==this.pageNotFound&&(console.log(this.pageNotFound),this.route_core(this.pageNotFound)),this.log("page not found : "+t),!1}draw(t){for(let e in this.config.path[t].res){if("js"===this.config.path[t].res[e].type){let i=this.config.path[t].res[e].dom;!1===this.config.path[t].res[e].reload?!1===this.config.reload_table[e]&&(this.config.reload_table[e]=!0,window.tmpui_helper.readyTotal++,$("body").append('<script class="tmpUIRes_once" type="text/javascript" ">\n'+i+"\nwindow.tmpui_helper.readyQueue++;<\/script>\n")):(window.tmpui_helper.readyTotal++,$("body").append('<script class="tmpUIRes" type="text/javascript" ">\n'+i+"\nwindow.tmpui_helper.readyQueue++;<\/script>\n"))}if("js-es6"===this.config.path[t].res[e].type){let i=Babel.transform(this.config.path[t].res[e].dom,{presets:["env"]}).code;!1===this.config.path[t].res[e].reload?!1===this.config.reload_table[e]&&(this.config.reload_table[e]=!0,window.tmpui_helper.readyTotal++,$("body").append('<script class="tmpUIRes_once" type="text/babel" ">\n'+i+"\nwindow.tmpui_helper.readyQueue++;<\/script>\n")):(window.tmpui_helper.readyTotal++,$("body").append('<script class="tmpUIRes" type="text/babel" ">\n'+i+"\nwindow.tmpui_helper.readyQueue++;<\/script>\n"))}if("css"===this.config.path[t].res[e].type&&(!1===this.config.path[t].res[e].reload?!1===this.config.reload_table[e]&&(this.config.reload_table[e]=!0,$("head").append('<link class="tmpUIRes_once" rel="stylesheet" href="'+e+"?v="+this.config.version+'" >\n')):$("head").append('<link class="tmpUIRes" rel="stylesheet" href="'+e+"?v="+this.config.version+'" >\n')),"tpl"===this.config.path[t].res[e].type){let i=this.config.path[t].res[e].dom;!1===this.config.path[t].res[e].reload?!1===this.config.reload_table[e]&&(this.config.reload_table[e]=!0,$("body").append('<div class="tmpUIRes_once" style="display:none" ">\n'+i+"</div>\n")):$("body").append('<div class="tmpUIRes" style="display:none" ">\n'+i+"</div>\n")}if("html"===this.config.path[t].res[e].type){if("append"===this.config.path[t].res[e].target.type){let i=this.config.path[t].res[e].dom;$("#tmpui_body").append(i)}if("body"===this.config.path[t].res[e].target.type){let i=this.config.path[t].res[e].dom;$("#tmpui_body").html(i)}if("id"===this.config.path[t].res[e].target.type){let i=this.config.path[t].res[e].target.val,n=this.config.path[t].res[e].dom;$("#"+i).replaceWith(n)}}this.log(e)}!1!==this.language_config&&this.language_build(),this.readyEvent()}loaderStart(t,e){this.loadCallback=e,console.log(t);for(let e in this.config.path[t].res)window.tmpui_helper.loadTotal++;for(let e in this.config.path[t].res)this.loaderUnit(t,e)}loaderUnit(t,e){if(void 0===this.config.path[t].res[e].state&&(this.config.path[t].res[e].state=0,this.config.path[t].res[e].dom=0),!1===this.config.path[t].res[e].reload&&void 0===this.config.reload_table[e]&&(this.config.reload_table[e]=!1),1===this.config.path[t].res[e].state)window.tmpui_helper.loadQueue++,this.loaderFinish();else{let i=new XMLHttpRequest;i.onreadystatechange=(()=>{4==i.readyState&&200==i.status&&(window.tmpui_helper.loadQueue++,this.config.path[t].res[e].state=1,this.config.path[t].res[e].dom=i.responseText,this.loaderFinish())}),i.open("GET",e+"?v="+this.version,!0),i.send()}}loaderFinish(){this.progress_enable&&!1===this.progress_status&&(this.progress_status=!0,this.animation_slice(),$("#tmpui_loading_show").append('<div class="tmpui_progress tmpui_round_conner" id="tmpui_loading_progress"><div class="tmpui_curRate tmpui_round_conner"></div></div>')),this.log("Queue:"+window.tmpui_helper.loadTotal+"|Finish:"+window.tmpui_helper.loadQueue);let t=Math.ceil(window.tmpui_helper.loadQueue/window.tmpui_helper.loadTotal*100);$(".tmpui_curRate").animate({width:t+"%"},this.animation_stime,()=>{100===t&&($("#tmpui_loading_progress").fadeOut(),$("body").css("overflow",""),$("#tmpui").fadeOut())}),window.tmpui_helper.loadQueue==window.tmpui_helper.loadTotal&&(this.log("Queue:"+window.tmpui_helper.loadTotal+"|Finish:"+window.tmpui_helper.loadQueue),"function"==typeof this.loadCallback&&this.loadCallback(),this.loadCallback=null,this.progress_status=!0)}animation_slice(){window.tmpui_helper.loadTotal>1?this.animation_stime=Math.ceil(this.animation_time/window.tmpui_helper.loadTotal):this.animation_stime=this.animation_time,this.log("Animation slice time: "+this.animation_stime+" ,total: "+this.animation_time)}title(t){$("title").html(t)}language_set(t){if(localStorage.getItem("language")===t)return!1;localStorage.setItem("language",t),this.language_build()}language_get(){return localStorage.getItem("language")}language_build(){var t=localStorage.getItem("language");if(this.log("language setting...."+t),null===t){var e=navigator.language;this.language_setting="en","zh-CN"!==e&&"zh-SG"!==e&&"zh"!==e||(this.language_setting="cn"),"zh-TW"!==e&&"zh-HK"!==e||(this.language_setting="hk"),"ja"!==e&&"ja-JP"!==e||(this.language_setting="jp"),"ru"!==e&&"ru-MI"!==e||(this.language_setting="ru"),"ko"===e&&(this.language_setting="kr"),"ms"===e&&(this.language_setting="my"),localStorage.setItem("language",this.language_setting)}else this.language_setting=t;window.tmpui_helper.readyTotal++,$.get(this.language_config[this.language_setting]+"?v="+this.version,t=>{window.tmpui_helper.readyQueue++,this.language_data=t;var e={};null!=t&&(e=t),$("[i18n]").each(function(t){var i=$(this).attr("i18n-only");null!=$(this).val()&&""!=$(this).val()&&(null!=i&&null!=i&&""!=i&&"value"!=i||$(this).val(e[$(this).attr("i18n")])),null!=$(this).html()&&""!=$(this).html()&&(null!=i&&null!=i&&""!=i&&"html"!=i||$(this).html(e[$(this).attr("i18n")])),null!=$(this).attr("placeholder")&&""!=$(this).attr("placeholder")&&(null!=i&&null!=i&&""!=i&&"placeholder"!=i||$(this).attr("placeholder",e[$(this).attr("i18n")])),null!=$(this).attr("content")&&""!=$(this).attr("content")&&(null!=i&&null!=i&&""!=i&&"content"!=i||$(this).attr("content",e[$(this).attr("i18n")])),null!=$(this).attr("title")&&""!=$(this).attr("title")&&(null!=i&&null!=i&&""!=i&&"title"!=i||$(this).attr("title",e[$(this).attr("i18n")]))})},"json")}description(t){$("meta[name=description]").attr("content",t)}loadpage(t){if(!this.loadingPage)return this.log("Loading page exit."),this.ready_exec(),!1;if(this.loadingPageInit||($("#tmpui").append('<div id="tmpui_loading_bg" style="background-color: rgba(255, 255, 255, 0.8);-webkit-backdrop-filter:saturate(180%) blur(20px);backdrop-filter: saturate(180%) blur(20px);"></div>'),$("#tmpui_loading_bg").append('<div id="tmpui_loading_show"></div>'),$("#tmpui_loading_show").append('<div style="text-align:center;margin-bottom:20px;" id="tmpui_loading_content"></div>'),!1!==this.loadingIcon?$("#tmpui_loading_content").append('<img src="'+this.loadingIcon+'" style="vertical-align: middle;border-style: none;width:129px;height:129px;"/>'):$("#tmpui_loading_content").append('<div style="text-align:center;font-family: fa5-proxima-nova,"Helvetica Neue",Helvetica,Arial,sans-serif;">'+this.loadingText+"</div>"),this.loadingPageInit=!0,this.log("Loading page created.")),t)$("body").css("overflow","hidden"),$("#tmpui").show(),this.doExit(),this.log("Loading page on");else{if(this.log("Loading page off"),this.progress_enable)return!0;$("body").css("overflow",""),$("#tmpui").fadeOut()}}tpl(t,e){let i=$("#"+t).html();return this.TemplateEngine(i,e)}TemplateEngine(t,e){if(""==t||null==t)return console.error("TemplateEngine::Html can't be null."),"";for(var i,n,a=/<%(.+?)%>/g,o=/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g,s="with(obj) { var r=[];\n",r=0,l=function(t,e){return s+=e?t.match(o)?t+"\n":"r.push("+t+");\n":""!=t?'r.push("'+t.replace(/"/g,'\\"')+'");\n':"",l};n=a.exec(t);)l(t.slice(r,n.index))(n[1],!0),r=n.index+n[0].length;l(t.substr(r,t.length-r)),s=(s+'return r.join(""); }').replace(/[\r\t\n]/g," ");try{i=new Function("obj",s).apply(e,[e])}catch(t){console.error("'"+t.message+"'"," in \n\nCode:\n",s,"\n")}return i}getUrlVars(t){var e={};t.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,i,n){e[i]=n});return e}log(t){this.debug&&console.log(t)}}